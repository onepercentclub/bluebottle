# -*- coding: utf-8 -*-
# Generated by Django 1.10.8 on 2018-08-27 15:10
from __future__ import unicode_literals

from bluebottle.utils.utils import update_group_permissions
from django.db import migrations, models
import django.db.models.deletion


# Functions from the following migrations need manual copying.
# Move them and any dependencies into this file, then update the
# RunPython operations to refer to the local versions:
# bluebottle.bb_projects.migrations.0003_auto_20160815_1658
# bluebottle.bb_projects.migrations.0006_add_group_permissions
# bluebottle.bb_projects.migrations.0007_auto_20180323_1602
# bluebottle.bb_projects.migrations.0008_migrate_theme_translations
# bluebottle.bb_projects.migrations.0011_migrate_phase_translations

def add_group_permissions(apps, schema_editor):
    group_perms = {
        'Anonymous': {
            'perms': ('api_read_projectphase', 'api_read_projecttheme',)
        },
        'Authenticated': {
            'perms': ('api_read_projectphase', 'api_read_projecttheme',)
        }
    }
    update_group_permissions('bb_projects', group_perms, apps)


class Migration(migrations.Migration):

    replaces = [(b'bb_projects', '0001_initial'), (b'bb_projects', '0002_remove_projecttheme_name_nl'), (b'bb_projects', '0003_auto_20160815_1658'), (b'bb_projects', '0004_add_project_continued_phase'), (b'bb_projects', '0005_add_api_permissions'), (b'bb_projects', '0006_add_group_permissions'), (b'bb_projects', '0007_translate_themes'), (b'bb_projects', '0008_migrate_theme_translations'), (b'bb_projects', '0009_remove_translated_fields'), (b'bb_projects', '0010_translate_phases'), (b'bb_projects', '0011_migrate_phase_translations'), (b'bb_projects', '0012_remove_translated_fields'), (b'bb_projects', '0007_auto_20180323_1602'), (b'bb_projects', '0013_merge_20180406_1536'), (b'bb_projects', '0007_auto_20180319_1536'), (b'bb_projects', '0008_merge_20180404_1500'), (b'bb_projects', '0008_merge_20180328_1504'), (b'bb_projects', '0009_merge_20180404_1638'), (b'bb_projects', '0014_merge_20180412_1421')]

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='ProjectPhase',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('slug', models.SlugField(max_length=200, unique=True)),
                ('name', models.CharField(max_length=100, unique=True)),
                ('description', models.CharField(blank=True, max_length=400)),
                ('sequence', models.IntegerField(help_text='For ordering phases.', unique=True)),
                ('active', models.BooleanField(default=True, help_text='Whether this phase is in use or has been discarded.')),
                ('editable', models.BooleanField(default=True, help_text='Whether the project owner can change the details of theproject.')),
                ('viewable', models.BooleanField(default=True, help_text='Whether this phase, and projects in it show up at the website')),
                ('owner_editable', models.BooleanField(default=False, help_text='The owner can manually select between these phases')),
            ],
            options={
                'ordering': ['sequence'],
            },
        ),
        migrations.CreateModel(
            name='ProjectTheme',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True, verbose_name='name')),
                ('slug', models.SlugField(max_length=100, unique=True, verbose_name='slug')),
                ('description', models.TextField(blank=True, verbose_name='description')),
                ('disabled', models.BooleanField(default=False, verbose_name='disabled')),
            ],
            options={
                'ordering': ['name'],
                'verbose_name': 'project theme',
                'verbose_name_plural': 'project themes',
            },
        ),
        migrations.AlterModelOptions(
            name='projectphase',
            options={'ordering': ['sequence'], 'permissions': (('api_read_projectphase', 'Can view project phase through API'),)},
        ),
        migrations.AlterModelOptions(
            name='projecttheme',
            options={'ordering': ['name'], 'permissions': (('api_read_projecttheme', 'Can view project theme through API'),), 'verbose_name': 'project theme', 'verbose_name_plural': 'project themes'},
        ),
        migrations.RunPython(
            add_group_permissions,
        ),
        migrations.CreateModel(
            name='ProjectThemeTranslation',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('language_code', models.CharField(db_index=True, max_length=15, verbose_name='Language')),
                ('name', models.CharField(max_length=100, verbose_name='name')),
                ('_description', models.TextField(blank=True, verbose_name='description')),
                ('master', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='translations', to='bb_projects.ProjectTheme')),
            ],
            options={
                'verbose_name': 'project theme Translation',
                'default_permissions': (),
                'db_table': 'bb_projects_projecttheme_translation',
                'managed': True,
                'db_tablespace': '',
            },
        ),
        migrations.AlterModelOptions(
            name='projecttheme',
            options={'ordering': ['translations__name'], 'permissions': (('api_read_projecttheme', 'Can view project theme through API'),), 'verbose_name': 'project theme', 'verbose_name_plural': 'project themes'},
        ),
        migrations.RenameField(
            model_name='projectthemetranslation',
            old_name='_description',
            new_name='description',
        ),
        migrations.RemoveField(
            model_name='projecttheme',
            name='description',
        ),
        migrations.RemoveField(
            model_name='projecttheme',
            name='name',
        ),
        migrations.CreateModel(
            name='ProjectPhaseTranslation',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('language_code', models.CharField(db_index=True, max_length=15, verbose_name='Language')),
                ('name', models.CharField(max_length=100, verbose_name='name')),
                ('_description', models.TextField(blank=True, verbose_name='description')),
                ('master', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='translations', to='bb_projects.ProjectPhase')),
            ],
            options={
                'verbose_name': 'project phase Translation',
                'default_permissions': (),
                'db_table': 'bb_projects_projectphase_translation',
                'managed': True,
                'db_tablespace': '',
            },
        ),
        migrations.AlterModelOptions(
            name='projecttheme',
            options={'ordering': ['slug'], 'permissions': (('api_read_projecttheme', 'Can view project theme through API'),), 'verbose_name': 'project theme', 'verbose_name_plural': 'project themes'},
        ),
        migrations.RenameField(
            model_name='projectphasetranslation',
            old_name='_description',
            new_name='description',
        ),
        migrations.RemoveField(
            model_name='projectphase',
            name='description',
        ),
        migrations.RemoveField(
            model_name='projectphase',
            name='name',
        ),
    ]
