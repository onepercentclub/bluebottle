# Generated by Django 4.2.20 on 2025-07-04 06:55

from django.db import connection, migrations

from bluebottle.clients import properties
from bluebottle.clients.models import Client
from bluebottle.clients.utils import LocalTenant
from bluebottle.utils.utils import update_group_permissions


def add_group_permissions(apps, schema_editor):
    tenant = Client.objects.get(schema_name=connection.tenant.schema_name)
    with LocalTenant(tenant):
        group_perms = {
            "Staff": {
                "perms": (
                    "add_grantprovider",
                    "change_grantprovider",
                    "delete_grantprovider",
                    "add_grantpayment",
                    "change_grantpayment",
                    "delete_grantpayment",
                    "add_grantpayout",
                    "change_grantpayout",
                    "delete_grantpayout",
                    "add_grantfund",
                    "change_grantfund",
                    "delete_grantfund",
                    "add_ledgeritem",
                    "change_ledgeritem",
                    "delete_ledgeritem",
                    "add_grantdonor",
                    "change_grantdonor",
                    "delete_grantdonor",
                    "add_grantdeposit",
                    "change_grantdeposit",
                    "delete_grantdeposit",
                )
            },
            "Anonymous": {
                "perms": (
                    (
                        "api_read_grantapplication",
                        "api_read_grantfund",
                    )
                    if not properties.CLOSED_SITE
                    else ()
                )
            },
            "Authenticated": {
                "perms": (
                    "api_read_grantapplication",
                    "api_add_own_grantapplication",
                    "api_change_own_grantapplication",
                    "api_delete_own_grantapplication",
                    "api_read_grantfund",
                    "api_read_grantdonor",
                )
            },
        }

    update_group_permissions("grant_management", group_perms, apps)


class Migration(migrations.Migration):

    dependencies = [
        ("grant_management", "0003_grantpayment_payment_link"),
    ]

    operations = [migrations.RunPython(add_group_permissions)]
