# -*- coding: utf-8 -*-
# Generated by Django 1.10.8 on 2018-04-16 09:15
from __future__ import unicode_literals

from django.db import migrations, connection

from bluebottle.clients import properties


def migrate_share_options(apps, schema_editor):
    ProjectPlatformSettings = apps.get_model('projects', 'ProjectPlatformSettings')
    Client = apps.get_model('clients', 'Client')

    project_settings, _ = ProjectPlatformSettings.objects.get_or_create()

    tenant = Client.objects.get(schema_name=connection.tenant.schema_name)
    properties.set_tenant(tenant)

    project_settings.share_options = [
        key for key, value in properties.SHARE_OPTIONS.items() if value
    ]

    if 'facebookAtWork' in project_settings.share_options:
        project_settings.facebook_at_work_url = 'https://booking.facebook.com'

    project_settings.save()



class Migration(migrations.Migration):

    dependencies = [
        ('projects', '0072_auto_20180416_1115'),
    ]

    operations = [
        migrations.RunPython(migrate_share_options)
    ]
