# -*- coding: utf-8 -*-
# Generated by Django 1.11.17 on 2020-11-17 11:44
from __future__ import unicode_literals
from __future__ import unicode_literals

from django.db import migrations, connection

from bluebottle.clients import properties
from bluebottle.clients.models import Client
from bluebottle.clients.utils import LocalTenant
from bluebottle.utils.utils import update_group_permissions


def add_group_permissions(apps, schema_editor):
    tenant = Client.objects.get(schema_name=connection.tenant.schema_name)
    with LocalTenant(tenant):
        group_perms = {
            'Staff': {
                'perms': (
                    'add_dateparticipant',
                    'change_dateparticipant',
                    'delete_dateparticipant',

                    'add_periodparticipant',
                    'change_periodparticipant',
                    'delete_periodparticipant',
                )
            },
            'Anonymous': {
                'perms': (
                    'api_read_dateparticipant',
                    'api_read_periodparticipant',
                ) if not properties.CLOSED_SITE else ()
            },
            'Authenticated': {
                'perms': (
                    'api_read_dateparticipant',
                    'api_add_dateparticipant',
                    'api_change_own_dateparticipant',
                    'api_delete_own_dateparticipant',

                    'api_read_periodparticipant',
                    'api_add_periodparticipant',
                    'api_change_own_periodparticipant',
                    'api_delete_own_periodparticipant',
                )
            }
    }

    update_group_permissions('time_based', group_perms, apps)


class Migration(migrations.Migration):

    dependencies = [
        ('time_based', '0032_auto_20201117_1143'),
    ]

    operations = [
        migrations.AlterModelOptions(
            name='dateactivity',
            options={'permissions': (('api_read_dateactivity', 'Can view on a date activities through the API'), ('api_add_dateactivity', 'Can add on a date activities through the API'), ('api_change_dateactivity', 'Can change on a date activities through the API'), ('api_delete_dateactivity', 'Can delete on a date activities through the API'), ('api_read_own_dateactivity', 'Can view own on a date activities through the API'), ('api_add_own_dateactivity', 'Can add own on a date activities through the API'), ('api_change_own_dateactivity', 'Can change own on a date activities through the API'), ('api_delete_own_dateactivity', 'Can delete own on a date activities through the API')), 'verbose_name': 'Activity on a date', 'verbose_name_plural': 'Activities on a date'},
        ),
        migrations.AlterModelOptions(
            name='dateparticipant',
            options={'permissions': (('api_read_dateparticipant', 'Can view application through the API'), ('api_add_dateparticipant', 'Can add application through the API'), ('api_change_dateparticipant', 'Can change application through the API'), ('api_delete_dateparticipant', 'Can delete application through the API'), ('api_read_own_dateparticipant', 'Can view own application through the API'), ('api_add_own_dateparticipant', 'Can add own application through the API'), ('api_change_own_dateparticipant', 'Can change own application through the API'), ('api_delete_own_dateparticipant', 'Can delete own application through the API')), 'verbose_name': 'Participant on a date', 'verbose_name_plural': 'Participants on a date'},
        ),
        migrations.AlterModelOptions(
            name='duration',
            options={'verbose_name': 'Participation', 'verbose_name_plural': 'Participations'},
        ),
        migrations.AlterModelOptions(
            name='periodactivity',
            options={'permissions': (('api_read_periodactivity', 'Can view during a period activities through the API'), ('api_add_periodactivity', 'Can add during a period activities through the API'), ('api_change_periodactivity', 'Can change during a period activities through the API'), ('api_delete_periodactivity', 'Can delete during a period activities through the API'), ('api_read_own_periodactivity', 'Can view own during a period activities through the API'), ('api_add_own_periodactivity', 'Can add own during a period activities through the API'), ('api_change_own_periodactivity', 'Can change own during a period activities through the API'), ('api_delete_own_periodactivity', 'Can delete own during a period activities through the API')), 'verbose_name': 'Activity during a period', 'verbose_name_plural': 'Activities during a period'},
        ),
        migrations.AlterModelOptions(
            name='periodparticipant',
            options={'permissions': (('api_read_periodparticipant', 'Can view period participant through the API'), ('api_add_periodparticipant', 'Can add period participant through the API'), ('api_change_periodparticipant', 'Can change period participant through the API'), ('api_delete_periodparticipant', 'Can delete period participant through the API'), ('api_read_own_periodparticipant', 'Can view own period participant through the API'), ('api_add_own_periodparticipant', 'Can add own participant through the API'), ('api_change_own_periodparticipant', 'Can change own period participant through the API'), ('api_delete_own_periodparticipant', 'Can delete own period participant through the API')), 'verbose_name': 'Participant during a period', 'verbose_name_plural': 'Participants during a period'},
        ),
        migrations.RunPython(
            add_group_permissions,
            migrations.RunPython.noop
        )
    ]
